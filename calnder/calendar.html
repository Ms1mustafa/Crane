<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AdminLTE 3 | Calendar</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css" />
  <!-- fullCalendar -->
  <link rel="stylesheet" href="plugins/fullcalendar/main.css" />
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css" />

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script src="../sheard.js" defer></script>
  <script src="../RequestesJs/Appointment/getAppointments.js" defer></script>
  <script src="../RequestesJs/Appointment/createAppointment.js" defer></script>
</head>

<body class="hold-transition sidebar-mini">
  <div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">

        </li>
        <!-- /.sidebar-menu -->
  </div>
  <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Calendar</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active">Calendar</li>
            </ol>
          </div>
        </div>
      </div>
      <!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-3">
            <div class="sticky-top mb-3">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title">Appointment Informations</h4>
                </div>
                <div class="card-body">
                  <!-- the events -->
                  <div id="external-events">
                    <div id="username">Name User</div>
                    <div id="rqNo">Rq NO</div>
                    <div id="typeAset">Type Aset</div>

                  </div>
                </div>
                <!-- /.card-body -->
              </div>
              <!-- /.card -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Create Appointment</h3>
                </div>
                <div class="card-body">
                  <div class="btn-group" style="width: 100%; margin-bottom: 10px">
                    <ul class="fc-color-picker" id="color-chooser">
                      <li>
                        <a class="text-primary"><i class="fas fa-square"></i></a>
                      </li>
                      <li>
                        <a class="text-warning"><i class="fas fa-square"></i></a>
                      </li>
                      <li>
                        <a class="text-success"><i class="fas fa-square"></i></a>
                      </li>
                      <li>
                        <a class="text-danger"><i class="fas fa-square"></i></a>
                      </li>
                      <li>
                        <a class="text-muted"><i class="fas fa-square"></i></a>
                      </li>
                    </ul>
                  </div>
                  <input type="text" id="area" class="form-control" placeholder="Aera">
                  <input type="text" id="location" class="form-control" placeholder="Location">
                  <input type="text" id="work_type" class="form-control" placeholder="WorkType">
                  <p>Start time</p>
                  <input type="datetime-local" class="form-control" id="start_date" placeholder="Time Book">
                  <p>End time</p>
                  <input type="datetime-local" class="form-control" id="end_date" placeholder="Time Book">
                  <!-- /btn-group -->
                  <div class="input-group">
                    <input id="title" type="text" class="form-control" placeholder=" Title" />

                    <div class="input-group-append">
                      <button id="createBtn" type="button" class="btn btn-primary">
                        Add
                      </button>
                    </div>
                    <!-- /btn-group -->
                  </div>
                  <!-- /input-group -->
                </div>
              </div>
            </div>
          </div>
          <!-- /.col -->
          <div class="col-md-9">
            <div class="card card-primary">
              <div class="card-body p-0">
                <!-- THE CALENDAR -->
                <div id="calendar"></div>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->

  <!-- jQuery -->
  <script src="plugins/jquery/jquery.min.js"></script>
  <!-- jQuery UI -->
  <script src="plugins/jquery-ui/jquery-ui.min.js"></script>
  <!-- fullCalendar 2.2.5 -->
  <script src="plugins/fullcalendar/main.js"></script>
  <!-- Page specific script -->
  <script>
    // time accept only 00 or 30 minutes
    document.getElementById("start_date").addEventListener("input", function () {
      var timeValue = this.value;
      var minutes = parseInt(timeValue.split(":")[1]);
      // If minutes is greater than 30, set it to 30; otherwise, set it to 0
      var roundedMinutes = minutes >= 30 ? 30 : 0;
      // Update the time value with the rounded minutes
      var roundedTimeValue = timeValue.split(":")[0] + ":" + (roundedMinutes < 10 ? '0' : '') + roundedMinutes;
      this.value = roundedTimeValue;
    });
    document.getElementById("end_date").addEventListener("input", function () {
      var timeValue = this.value;
      var minutes = parseInt(timeValue.split(":")[1]);
      // If minutes is greater than 30, set it to 30; otherwise, set it to 0
      var roundedMinutes = minutes >= 30 ? 30 : 0;
      // Update the time value with the rounded minutes
      var roundedTimeValue = timeValue.split(":")[0] + ":" + (roundedMinutes < 10 ? '0' : '') + roundedMinutes;
      this.value = roundedTimeValue;
    });

    // format date time
    let start_date = document.getElementById('start_date');
    let start_dateValue = start_date.value;

    start_date.addEventListener('change', function () {
      const formattedStart_date = formatDateTime(start_date.value);
      start_dateValue = formattedStart_date;
    });
    let end_date = document.getElementById('end_date');
    let end_dateValue = end_date.value;

    end_date.addEventListener('change', function () {
      const formattedEnd_date = formatDateTime(end_date.value);
      end_dateValue = formattedEnd_date;
    });

    var currColor = "#3c8dbc"; //Red by default
    // Color chooser button
    $("#color-chooser > li > a").click(function (e) {
      e.preventDefault();
      // Save color
      currColor = $(this).css("color");
      // Add color effect to button
      $("#createBtn").css({
        "background-color": currColor,
        "border-color": currColor,
      });
    });


    $(function () {
      /* initialize the external events
   -----------------------------------------------------------------*/
      function ini_events(ele) {
        ele.each(function () {
          // create an Event Object (https://fullcalendar.io/docs/event-object)
          // it doesn't need to have a start or end
          var eventObject = {
            title: $.trim($(this).text()), // use the element's text as the event title
          };

          // store the Event Object in the DOM element so we can get to it later
          $(this).data("eventObject", eventObject);

          // make the event draggable using jQuery UI
          $(this).draggable({
            zIndex: 1070,
            revert: true, // will cause the event to go back to its
            revertDuration: 0, //  original position after the drag
          });
        });
      }

      ini_events($("#external-events div.external-event"));

      /* initialize the calendar
   -----------------------------------------------------------------*/
      //Date for the calendar events (dummy data)
      var date = new Date();
      var d = date.getDate(),
        m = date.getMonth(),
        y = date.getFullYear();

      var Calendar = FullCalendar.Calendar;
      var Draggable = FullCalendar.Draggable;

      var containerEl = document.getElementById("external-events");
      var checkbox = document.getElementById("drop-remove");
      var calendarEl = document.getElementById("calendar");

      // initialize the external events
      // -----------------------------------------------------------------

      new Draggable(containerEl, {
        itemSelector: ".external-event",
        eventData: function (eventEl) {
          return {
            title: eventEl.innerText,
            backgroundColor: window
              .getComputedStyle(eventEl, null)
              .getPropertyValue("background-color"),
            borderColor: window
              .getComputedStyle(eventEl, null)
              .getPropertyValue("background-color"),
            textColor: window
              .getComputedStyle(eventEl, null)
              .getPropertyValue("color"),
          };
        },
      });

      var calendar = new Calendar(calendarEl, {
        headerToolbar: {
          left: "prev,next today",
          center: "title",
          right: "timeGridDay,timeGridWeek,dayGridMonth",
        },
        themeSystem: "bootstrap",
        //Random default events
        events: [],
        editable: false,
        droppable: false,
        initialView: "timeGridDay",
        drop: function (info) {
          // is the "remove after drop" checkbox checked?
          if (checkbox.checked) {
            // if so, remove the element from the "Draggable Events" list
            info.draggedEl.parentNode.removeChild(info.draggedEl);
          }

        },
      });
      calendar.render();
    });

    /*
    events: [
            {
              title: "All MW Event",
              start: new Date(y, m, d, 7),
              end: new Date(y, m, d, 8),
              backgroundColor: "#f56954", //red
              borderColor: "#f56954", //red
              allDay: false,
            },
            {
              title: "Long Event",
              start: new Date(y, m, d - 5),
              end: new Date(y, m, d - 2),
              backgroundColor: "#f39c12", //yellow
              borderColor: "#f39c12", //yellow
            },
            {
              title: "Meeting",
              start: new Date(y, m, d, 10, 30),
              allDay: false,
              backgroundColor: "#0073b7", //Blue
              borderColor: "#0073b7", //Blue
            },
            {
              title: "Lunch time",
              start: new Date(y, m, d, 12, 0),
              end: new Date(y, m, d, 13, 0),
              allDay: false,
              backgroundColor: "#f56954", //Info (aqua)
              borderColor: "#f56954", //Info (aqua)
            },
            {
              title: "Diner time",
              start: new Date(y, m, d, 18, 0),
              end: new Date(y, m, d, 19, 0),
              allDay: false,
              backgroundColor: "#f56954", //Info (aqua)
              borderColor: "#f56954", //Info (aqua)
            },
            {
              title: "Birthday Party",
              start: new Date(y, m, d + 1, 19, 0),
              end: new Date(y, m, d + 1, 22, 30),
              allDay: false,
              backgroundColor: "#00a65a", //Success (green)
              borderColor: "#00a65a", //Success (green)
            },
            {
              title: "Click for Google",
              start: new Date(y, m, 28),
              end: new Date(y, m, 29),
              url: "https://www.google.com/",
              backgroundColor: "#3c8dbc", //Primary (light-blue)
              borderColor: "#3c8dbc", //Primary (light-blue)
            },
          ],
    */
  </script>
</body>

</html>